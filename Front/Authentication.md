# 인증과 인가

- 자원을 적절한/유효한 사용자에게 전달/공개 하기 위한 방법



## 인증

- 식별 가능한 정보로 서비스에 등록된 유저의 신원을 입증하는 과정

  

## 인가

- 권한에 대한 허가, 인증된 사용자에 대한 자원 접근 권한 확인
  - ex) 구미 캠퍼스 방문 시, 강의장은 들어갈 수 있으나 사업장 접근 권한이 없음.(인가 되지 않음)





## 웹에서의 인증과 인가

- 유저의 회원가입 및 로그인 = 인증
- 글을 쓸 수 있는 권한 획득 = 인가
  - but 다른 사람 글을 수정할 수 없음.

`* HTTP의 stateless한 특징으로 인증을 유지 시키는 기술이 필요 함. `



### 1. 인증하기 (로그인 하기)

- Request Header 활용
- Id와 password를 url에 넣어줌
  - `httpL//userId:password@www.naver.com/login`
  - 해당 url의 Id/Password를 파싱 후 Base64 인코더를 통해 요청 헤더에 넣어서 요청 함.

- 매번 인증 요청을 해야 함.

### 2. 인증 유지하기

- Browser
- 쿠키에 유저 인증정보를 넣어두고, 요청 시에 쿠키를 같이 보내줌.
  => 해커에게 털리기 쉬움.

### 3. 안전하게 인증하기

- Server(세션)
- SESSIONID을 응답의 Header에 넘겨주고, 이것을 저장하게 만듦.
  - 클라에서 사용자의 raw data를 가지고 있지 않고, 세션 만료 기간 설정 가능하여 만료 기간 이후에는 유효하지 않음.
  - 세션을 서버에서 관리하여, 탈취한 세션을 서버에서 삭제 하면 이를 이용할 수 없음.
  - but 서버가 여러개 일 때, 최초 발급한 세션이 있는 서버가 아닌 다른서버에 요청을 할 때 에러 발생 함.
    => 세션 stroage 도입하여 해결 함. (세션을 한 곳에서 관리)
    but 클라이언트가 많아질 경우, 서버가 터질 수 있음.

### 4. 효율적으로 인증하기

- Token
- 정보의 요청 응답 안에(컨텐츠 안에) 사용자 상태를 담는 것
- JSON WEB TOKEN : 시크릿 키를 사용해 jwt를 만들고, 인증 과정을 거침. 해독하기 쉬워 민감한정보를 담지 않음.
  - 시크릿 키를 서버내에 잘 관리 하여야 함.
  - access token 탈취당하면 위험함 => 만료 시간을 정함. (30분) => 사용자도 불편함 => refresh token
    - 시크릿 키로 토큰을 만들 때 acess token + refresh token을 한번에 만듦.
    - access token은 저장 x, refresh token만 저장 후 클라에게 둘다 넘겨줌.
    - access token이 만료 되면, 클라가 refresh token과 함께 서버에 요청. refresh token과 일치 할경우 새 access token을 넘겨줌
- 토큰으로 상태 관리를 하기에 따로 세션을 둘 필요가 없으나 토큰도 관리 대상이기 때문에 보안에 신경을 써야 함.
